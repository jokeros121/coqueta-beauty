<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Coqueta</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* Animación personalizada para el menú */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .menu-item {
      animation: fadeIn 0.3s ease-out forwards;
      opacity: 0;
    }
    
    .menu-item:nth-child(1) { animation-delay: 0.1s; }
    .menu-item:nth-child(2) { animation-delay: 0.2s; }
    .menu-item:nth-child(3) { animation-delay: 0.3s; }
    .menu-item:nth-child(4) { animation-delay: 0.4s; }
    .menu-item:nth-child(5) { animation-delay: 0.5s; }
    
    /* Estilo para el ítem activo */
    .menu-item.active {
      background-color: #fbcfe8;
      color: #831843;
      font-weight: 600;
    }
    
    .menu-item.active i {
      color: #db2777;
      transform: scale(1.1);
    }
    
    .menu-item.active .fa-chevron-right {
      opacity: 1;
    }
    
    /* Mejor scroll para móviles */
    @media (max-width: 767px) {
      #sidebar {
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding-top: 70px;
      }
      
      #menu-toggle {
        z-index: 60;
        transition: transform 0.3s ease;
      }
      
      #sidebar.open ~ #menu-toggle {
        transform: translateX(calc(16rem - 20px));
      }
    }
  </style>
</head>

<body class="bg-pink-50 min-h-screen flex flex-col md:flex-row">
  <!-- Menú lateral -->
  <aside id="sidebar"
    class="w-64 bg-gradient-to-b from-pink-50 to-white shadow-lg h-screen md:relative fixed top-0 left-0 z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300 border-r border-pink-200 p-6 flex flex-col justify-between">
    <div>
      <!-- Logo con línea de separación -->
      <div class="flex flex-col mb-8">
        <div class="flex items-center">
          <i class="fas fa-spa text-2xl text-pink-600 mr-3 animate-pulse"></i>
          <h1 class="text-2xl font-bold text-pink-600 bg-clip-text bg-gradient-to-r from-pink-500 to-pink-700">Coqueta</h1>
        </div>
        <div class="h-px bg-gradient-to-r from-transparent via-pink-300 to-transparent my-4 w-full"></div>
      </div>

      <!-- Menú de navegación -->
      <nav class="space-y-2">
        <a href="secciones/inicio.html" target="contenido" id="menu-inicio"
          class="menu-item flex items-center p-3 rounded-lg text-pink-700 hover:bg-pink-100 hover:text-pink-800 transition-all duration-200 group">
          <i class="fas fa-home mr-3 text-pink-500 group-hover:scale-110 transition-transform"></i>
          <span class="font-medium">Inicio</span>
          <i class="fas fa-chevron-right ml-auto text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
        </a>

        <a href="secciones/clientes.html" target="contenido" id="menu-clientes"
          class="menu-item flex items-center p-3 rounded-lg text-pink-700 hover:bg-pink-100 hover:text-pink-800 transition-all duration-200 group">
          <i class="fas fa-users mr-3 text-pink-500 group-hover:scale-110 transition-transform"></i>
          <span class="font-medium">Clientes</span>
          <i class="fas fa-chevron-right ml-auto text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
        </a>

        <a href="secciones/reservas.html" target="contenido" id="menu-reservas"
          class="menu-item flex items-center p-3 rounded-lg text-pink-700 hover:bg-pink-100 hover:text-pink-800 transition-all duration-200 group">
          <i class="fas fa-calendar-check mr-3 text-pink-500 group-hover:scale-110 transition-transform"></i>
          <span class="font-medium">Reservas</span>
          <i class="fas fa-chevron-right ml-auto text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
        </a>

        <a href="secciones/servicios.html" target="contenido" id="menu-servicios"
          class="menu-item flex items-center p-3 rounded-lg text-pink-700 hover:bg-pink-100 hover:text-pink-800 transition-all duration-200 group">
          <i class="fa-solid fa-scissors mr-3 text-pink-500 group-hover:scale-110 transition-transform"></i>
          <span class="font-medium">Servicios</span>
          <i class="fas fa-chevron-right ml-auto text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
        </a>

        <a href="secciones/profesionales.html" target="contenido" id="menu-profesionales"
          class="menu-item flex items-center p-3 rounded-lg text-pink-700 hover:bg-pink-100 hover:text-pink-800 transition-all duration-200 group">
          <i class="fas fa-user-tie mr-3 text-pink-500 group-hover:scale-110 transition-transform"></i>
          <span class="font-medium">Profesionales</span>
          <i class="fas fa-chevron-right ml-auto text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
        </a>
      </nav>
    </div>

    <!-- Sección de usuario -->
    <div class="bg-pink-50 p-4 rounded-xl border border-pink-100 mt-6 shadow-sm">
      <p class="text-gray-600 mb-2 flex items-center">
        <i class="fas fa-user-circle mr-2 text-pink-500"></i>
        <span>Hola, <span id="username-display" class="font-bold text-pink-700">Usuario</span></span>
      </p>
      <p id="countdown-timer"
        class="text-sm bg-white p-2 rounded-lg text-pink-700 font-mono mb-4 flex items-center shadow-inner">
        <i class="fas fa-clock mr-2 animate-pulse"></i>
        <span>Sesión expira en: 00:00</span>
      </p>
      <button id="logout-btn"
        class="w-full bg-gradient-to-r from-pink-500 to-pink-600 text-white py-2 rounded-lg hover:from-pink-600 hover:to-pink-700 transition-all duration-300 flex items-center justify-center group shadow-md hover:shadow-lg">
        <i class="fas fa-sign-out-alt mr-2 group-hover:animate-bounce"></i>
        <span>Cerrar Sesión</span>
      </button>
    </div>
    <p class="text-center text-xs text-gray-400 mt-6">Desarrollado por Algemiro Terán</p>
  </aside>

  <!-- Botón para abrir/cerrar menú en móviles -->
  <button id="menu-toggle" class="md:hidden bg-pink-600 text-white p-3 m-3 rounded-lg shadow fixed top-0 left-0 z-50 transition-all duration-300 hover:bg-pink-700">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Contenido dinámico -->
  <main class="flex-1 mt-16 md:mt-0">
    <iframe name="contenido" src="secciones/inicio.html" class="w-full h-screen border-none" id="main-iframe"></iframe>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Mostrar usuario
      const username = localStorage.getItem('user') || 'Usuario';
      document.getElementById('username-display').textContent = username;

      // Logout
      const logoutBtn = document.getElementById('logout-btn');
      logoutBtn.addEventListener('click', (e) => {
        e.preventDefault();
        logoutAndRedirect();
      });

      function logoutAndRedirect() {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        localStorage.removeItem('token_expiration');
        window.location.href = 'login.html';
      }

      // Validar token y expiración
      const token = localStorage.getItem('token');
      const expiration = localStorage.getItem('token_expiration');
      const now = Date.now();

      if (!token || !expiration || now > parseInt(expiration)) {
        logoutAndRedirect();
        return;
      }

      // Contador regresivo
      const timerEl = document.getElementById('countdown-timer');

      function updateTimer() {
        const now = Date.now();
        const diff = parseInt(expiration) - now;

        if (diff <= 0) {
          logoutAndRedirect();
          return;
        }

        const minutes = Math.floor(diff / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);

        timerEl.innerHTML = `<i class="fas fa-clock mr-2 ${minutes < 5 ? 'animate-pulse text-red-500' : ''}"></i>
                            <span>Sesión expira en: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}</span>`;
      }

      updateTimer();
      setInterval(updateTimer, 1000);

      // Menú responsive
      const toggleBtn = document.getElementById('menu-toggle');
      const sidebar = document.getElementById('sidebar');
      const toggleIcon = toggleBtn.querySelector('i');

      toggleBtn.addEventListener('click', () => {
        sidebar.classList.toggle('-translate-x-full');
        sidebar.classList.toggle('open');
        
        if (sidebar.classList.contains('-translate-x-full')) {
          toggleIcon.classList.remove('fa-times');
          toggleIcon.classList.add('fa-bars');
          toggleBtn.classList.remove('bg-pink-700');
          toggleBtn.classList.add('bg-pink-600');
        } else {
          toggleIcon.classList.remove('fa-bars');
          toggleIcon.classList.add('fa-times');
          toggleBtn.classList.remove('bg-pink-600');
          toggleBtn.classList.add('bg-pink-700');
        }
      });

      // Resaltar sección activa - SOLUCIÓN MEJORADA
      const menuItems = document.querySelectorAll('#sidebar nav a');
      let currentActive = 'menu-inicio'; // Por defecto la página de inicio
      
      // Función para actualizar el ítem activo
      function updateActiveMenuItem(menuId) {
        // Remover clase active de todos los ítems
        menuItems.forEach(item => {
          item.classList.remove('active');
        });
        
        // Activar el nuevo ítem
        if (menuId) {
          currentActive = menuId;
          document.getElementById(menuId).classList.add('active');
        } else {
          document.getElementById(currentActive).classList.add('active');
        }
      }
      
      // Event listeners para los items del menú
      menuItems.forEach(item => {
        item.addEventListener('click', function() {
          const menuId = this.id;
          updateActiveMenuItem(menuId);
          
          // Para móviles, cerramos el menú al hacer clic
          if (window.innerWidth < 768) {
            sidebar.classList.add('-translate-x-full');
            sidebar.classList.remove('open');
            toggleIcon.classList.replace('fa-times', 'fa-bars');
            toggleBtn.classList.remove('bg-pink-700');
            toggleBtn.classList.add('bg-pink-600');
          }
        });
      });
      
      // Inicializar con la sección de inicio activa
      updateActiveMenuItem();

      // Solución para iframe - usando postMessage
      window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'sectionChanged') {
          const sectionMap = {
            'inicio': 'menu-inicio',
            'clientes': 'menu-clientes',
            'reservas': 'menu-reservas',
            'servicios': 'menu-servicios',
            'profesionales': 'menu-profesionales'
          };
          
          if (sectionMap[event.data.section]) {
            updateActiveMenuItem(sectionMap[event.data.section]);
          }
        }
      });

      // Cerrar menú al hacer clic fuera en móviles
      document.addEventListener('click', (e) => {
        if (window.innerWidth < 768 && 
            !sidebar.contains(e.target) && 
            e.target !== toggleBtn && 
            !sidebar.classList.contains('-translate-x-full')) {
          sidebar.classList.add('-translate-x-full');
          sidebar.classList.remove('open');
          toggleIcon.classList.replace('fa-times', 'fa-bars');
          toggleBtn.classList.remove('bg-pink-700');
          toggleBtn.classList.add('bg-pink-600');
        }
      });
    });
  </script>
</body>
</html>